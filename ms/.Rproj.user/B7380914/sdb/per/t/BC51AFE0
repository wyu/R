{
    "contents" : "qcRunThroughput=function()\n{\n  library(lattice)\n  library(reshape)\n\n  #thro = read.csv(stringsAsFactors=F, row.names=NULL, \"/home/wyu/Projects/R/data/sputum_thro_59881.csv\")\n  \n  dir = \"/home/wyu/Projects/R/ms/data/ms.qc\"\n  fileNames = list.files(dir)\n  \n  rawData = lapply(fileNames, function(fileName){read.csv(paste(dir,\"/\",fileName,sep=\"\"),stringsAsFactors=FALSE)})\n  names(rawData) = sub(\".csv\",\"\",fileNames)\n  \n  thro = do.call(\"rbind\", rawData); rm(rawData, fileNames)\n\n  # fixup the desc\n  thro[thro$name==\"Or2013_0513_CF_03\", ]$desc = \"post repair\"\n  thro[thro$name==\"Or2013_0513_CF_04\", ]$desc = \"post repair\"\n  \n  # remove the row col\n  thro$row     = NULL\n  # set the default loading to 1ug for the sputum samples\n  thro[thro$id.prj==2862&is.na(thro$loading),]$loading = 1\n\n  # convert the columns\n  thro$id.run  = as.factor(thro$id.run)\n  thro$id.prj  = as.factor(thro$id.prj)\n  thro$id.expt = as.factor(thro$id.expt)\n  thro$rt.pct  = as.numeric(thro$rt.pct)\n  thro$rt      = as.numeric(thro$rt)\n  thro$width   = as.numeric(thro$width)  \n  thro$annot   = as.logical(thro$annot)\n  thro$loading = as.factor(thro$loading)\n  \n  # prepare the list of runs\n  md = melt(thro, id=c(\"id.run\", \"id.prj\", \"id.expt\", \"rt\", \"rt.pct\", \"slice\", \"loading\", \"annot\", \"name\", \"desc\", \"width\"))\n  runs = cast(md, id.run+id.expt+id.prj+name+desc+loading ~ .)\n    \n  plotParam = list(\n    stim = simpleTheme(pch = c(15:20),\n                             lty = c(2,1,3,3,2, 2,1,2,2,1, 2,1,2,1),\n                             lwd = c(2,2,1,1,2,2,2,2,2,2,2,2,2,2,2,1),\n                             cex = c(1.5),\n                             col=c(rep(\"purple\",4),rep(\"blue\",3),rep(\"green\",3),rep(\"yellow\",3),rep(\"orange\",3),rep(\"red\",4))),\n    thin3  = simpleTheme(pch=c(19, 12, 22),cex=1.25,lwd=1,col=c(\"red\",\"darkgreen\",\"blue\")),\n    thin6  = simpleTheme(pch=c(19, 12, 22),cex=0.8,lwd=0.8,col=c(\"red\",\"darkgreen\",\"blue\")),\n    thin   = simpleTheme(pch=c(10:22),cex=0.8,lwd=0.8),\n    thin6.vert.x = simpleTheme(pch=c(19, 12, 22),cex=0.8,lwd=0.8,col=c(\"red\",\"darkgreen\",\"blue\")),\n    chart.layout = c(3,2))\n  \n  repairs = subset(thro, id.expt==35187|id.expt==34987)\n  repairs$id.expt = as.factor(repairs$id.expt)\n  xyplot(log10(apex) ~ rt.pct|desc, group = id.expt, data=repairs, auto.key=list(space=\"top\",columns=4), par.settings=plotParam$thin)\n  xyplot(pkw ~ rt.pct|desc, group = id.expt, data=repairs, auto.key=list(space=\"top\",columns=4), par.settings=plotParam$thin)\n  xyplot(ppm ~ rt.pct|desc, group = id.expt, data=repairs, auto.key=list(space=\"top\",columns=4), par.settings=plotParam$thin)\n  xyplot(mz ~ rt.pct|desc, group = id.expt, data=repairs, auto.key=list(space=\"top\",columns=4), par.settings=plotParam$thin)\n  xyplot(mass ~ rt.pct|id.run, group = id.expt, data=repairs, par.settings=plotParam$thin)\n  \n  sputum = subset(thro, id.prj==2862&desc!=\"Velos Orbitrap\")\n  # LC peak width and apex\n  xyplot(pkw ~ rt.pct|loading, group = desc, data=sputum, auto.key=list(space=\"top\",columns=4), par.settings=plotParam$thin)\n  xyplot(log10(apex) ~ rt.pct|loading, group = desc, data=sputum, auto.key=list(space=\"top\",columns=4), par.settings=plotParam$thin)\n  # apex of LCMS\n  xyplot(apex ~ rt|name, data=thro, subset=id.prj==2862)\n  # apex of LCMS by loading\n  xyplot(apex ~ rt|desc, data=thro, subset=id.prj==2862)\n  # does higher loading produce more peptides?\n  xyplot(err.n ~ rt.pct|desc, group=name, data=thro, subset=annot==TRUE&id.expt %in% c(34278,34908,34909,34910))\n  xyplot(err.n ~ rt.pct|desc, group=name, data=thro, subset=annot==TRUE&id.run %in% c(73254,73256,73258))\n  xyplot(err.n ~ log(apex)|desc, group=name, data=thro, subset=annot==TRUE&id.run %in% c(73254,73256,73258))\n  # does higher loading produce more peptides?\n  xyplot(err.n ~ rt|desc, data=thro, subset=id.prj==2862)\n  \n  newdata <- cast(md, id.run + rt + slice + val + annot ~ variable)\n  j1 = subset(thro, slice==\"mw\"&annot==TRUE)\n  j2 = cbind(subset(j1, stat==\"apex\")$val, subset(j1, stat==\"tic\")$val)\n  xyplot(pkw ~ rt|name, data=thro)\n  xyplot(val~rt.pct|name, data=junk, type=c(\"p\",\"l\"), scales=\"free\")\n  xyplot(val~rt.pct|stat, data=subset(thro, slice==\"mw\"), group=name, type=c(\"p\",\"l\"), scales=\"free\", auto.key=TRUE)\n  xyplot(val/width~rt.pct|stat, data=subset(thro, slice==\"slot\"), group=name, type=c(\"p\",\"l\"), scales=\"free\", auto.key=TRUE)\n}",
    "created" : 1368377992828.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1901364733",
    "id" : "BC51AFE0",
    "lastKnownWriteTime" : 1368675406,
    "path" : "~/Projects/R/ms/codes/qcRunThroughPut.r",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}