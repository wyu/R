{
    "contents" : "plotBCellsCtrl = function(dFrame) {\n  # subset only the relevant data\n  D = subset(dFrame, controls!=\"samples\")\n  D$antiIgD = factor(D$antiIgD, level=c(\"NPC\", \"PBS\", \"0.5\", \"10\"), ordered=T)    \n  \n  plotParameters = list(\n    themeForStimPlots = simpleTheme(pch = c(15:20),\n                                    lty = c(2,1,3,3,2, 2,1,2,2,1, 2,1,2,1),\n                                    lwd = c(2,2,1,1,2,2,2,2,2,2,2,2,2,2,2,1),\n                                    cex = c(1.5),\n                                    col=c(rep(\"purple\",4),rep(\"blue\",3),rep(\"green\",3),\n                                          rep(\"yellow\",3),rep(\"orange\",3),rep(\"red\",4))),\n    thin3  = simpleTheme(pch=c(19, 12, 22),cex=1.25,lwd=1,col=c(\"red\",\"darkgreen\",\"blue\")),\n    thin6  = simpleTheme(pch=c(19, 12, 22),cex=0.8,lwd=0.8,col=c(\"red\",\"darkgreen\",\"blue\")),\n    thin6.vert.x = simpleTheme(pch=c(19, 12, 22),cex=0.8,lwd=0.8,col=c(\"red\",\"darkgreen\",\"blue\")),\n    chart.layout = c(3,2))\n  \n  # make up a new column reflecting the order or the row\n  D$rowid = factor(paste(D$patientId, D$timepoint, sep=\",\"), ordered=T)  \n  \n  xyplot(BCells~rowid|Period,group=antiIgD,\n         data=D,\n         type=c(\"a\", \"g\", \"p\"),\n         scale=list(alternating=1, x=list(rot=90), y=list(limits=c(0,max(D$BCells)))),\n         strip = FALSE,\n         auto.key=list(space=\"top\",columns=3),                                    \n         par.settings=plotParameters$thin6,\n         layout=c(3,2), as.table=TRUE,\n         xlab=\"log[antiIgD], ug/ml\", \n         ylab=\"MFI of pAKT in B Cells from the pre/post run Controls\")\n\n  # establish the linear model for each subject, period\n  #lm.10p1 = lm(BCells~rowid, subset(D, (antiIgD==10)&(Period==1)&(controls==\"cntrl-A1004\")))\n  #lm.10p2 = lm(BCells~rowid, subset(D, (antiIgD==10)&(Period==2)))\n  #y4ec90 = predict(lm.fit, newdata=data.frame(logAntiIgD=ec90))     \n\n  #trellis.focus(\"panel\", 1, 1)\n  #panel.segments(ec90-0.5, y4ec90, x1=ec90+0.5, y1=y4ec90, col=colors[tp][[1]])      \n  #trellis.unfocus()    \n  \n  # do the box plot instead\n  bwplot(BCells~Period|controls*antiIgD, data=D, \n         auto.key=T,type=c(\"p\",\"a\",\"g\"),\n         layout=c(4,1), as.table=TRUE,\n         main=\"CV of pAKT Measurements from Pre/Post Run Ctrls @ antiIgD=10\") \n  bwplot(BCells~Period|controls, data=subset(D, antiIgD==0.5), \n         auto.key=T,type=c(\"p\",\"a\",\"g\"),\n         layout=c(1,2), as.table=TRUE,\n         scale=list(y=list(limits=c(0,max(D$BCells)))),\n         main=\"CV of pAKT Measurements from Pre/Post Run Ctrls @ antiIgD=0.5\") \n  \n  # calculate the CV\n  co.var   <- function(x) ( 100*sd(x)/mean(x))\n  by_sample = list(patientId=D$controls, antiIgD=D$antiIgD, period=D$Period)\n  sample.cv   = aggregate(x=D, by=by_sample, FUN=co.var)\n  sample.mean = aggregate(x=D, by=by_sample, FUN=mean)\n  \n  D = subset(dFrame, antiIgD==\"NPC\")\n  \n  D$rowid = factor(paste(D$patientId, D$antiIgD, D$timepoint, sep=\",\"), ordered=T)  \n  \n  xyplot(BCells~rowid|Period,\n         data=D,\n         type=c(\"a\", \"g\", \"p\"),\n         scale=list(alternating=1, y=list(limits=c(0,max(D$BCells)))),\n         strip = TRUE,\n         auto.key=list(space=\"top\",columns=3),                                    \n         par.settings=plotParameters$thin6.vert.x,\n         layout=c(3,1), as.table=TRUE,\n         xlab=\"log[antiIgD], ug/ml\", \n         ylab=\"MFI of pAKT in B Cells from the pre/post run Controls\")\n}",
    "created" : 1368381079214.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "810514196",
    "id" : "934EF92",
    "lastKnownWriteTime" : 1360121792,
    "path" : "~/Projects/R/ms/codes/plotBCellsCtrl.r",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}